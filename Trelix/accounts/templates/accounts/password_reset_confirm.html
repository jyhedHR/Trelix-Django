{% extends "trelix/base.html" %}
{% load static %}

{% block title %} Set New Password {% endblock %}  

{% block content %}
<section class="signup-sec full-screen">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-xl-5 col-md-5">
        <div class="signup-thumb">
          <img class="img-fluid" src="{% static 'images/shape-bg.png' %}" alt="Set New Password" />
        </div>
      </div>
      <div class="col-xl-7 col-md-7">
        <div class="login-form">
          <h1 class="display-3 text-center mb-5">Set New Password</h1>
          
          {% if form.errors %}
            <div class="alert alert-danger" role="alert">
              {% for field, errors in form.errors.items %}
                {% for error in errors %}
                  <p class="mb-0">{{ error }}</p>
                {% endfor %}
              {% endfor %}
            </div>
          {% endif %}
          
          {% if validlink %}
            <p class="text-center text-muted mb-4">
              Please enter your new password twice so we can verify you typed it correctly.
            </p>
            
            <form method="post">
              {% csrf_token %}
              
              <div class="form-group position-relative mb-3">
                <span><i class="feather-icon icon-lock"></i></span>
                <input 
                  type="password" 
                  name="new_password1" 
                  class="form-control" 
                  placeholder="Enter new password" 
                  required 
                  autofocus
                  minlength="8"
                >
                {% if form.new_password1.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.new_password1.errors %}
                      <p class="mb-0">{{ error }}</p>
                    {% endfor %}
                  </div>
                {% endif %}
                <small class="form-text text-muted">
                  Your password must contain at least 8 characters.
                </small>
              </div>

              <div class="form-group position-relative mb-4">
                <span><i class="feather-icon icon-lock"></i></span>
                <input 
                  type="password" 
                  name="new_password2" 
                  class="form-control" 
                  placeholder="Confirm new password" 
                  required
                  minlength="8"
                >
                {% if form.new_password2.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.new_password2.errors %}
                      <p class="mb-0">{{ error }}</p>
                    {% endfor %}
                  </div>
                {% endif %}
              </div>

              <button class="btn btn-primary w-100 mb-3" type="submit">
                Change Password
              </button>

              <div class="text-center">
                <a href="{% url 'accounts:signin' %}" class="text-primary">
                  <i class="feather-icon icon-arrow-left"></i> Back to Sign In
                </a>
              </div>
            </form>
          {% else %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Invalid Link</h5>
              <p class="mb-0">
                The password reset link is invalid, possibly because it has already been used 
                or has expired. Please request a new password reset.
              </p>
            </div>
            
            <div class="text-center mt-4">
              <a href="{% url 'accounts:password_reset' %}" class="btn btn-primary">
                Request New Reset Link
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

